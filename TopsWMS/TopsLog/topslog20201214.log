
**************************************************************************************************************------>2020/12/14 15:49:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:49:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:49:04
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:49:04
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:51:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:04
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:04
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else d_ListPutOnOff_LaunchTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:57
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:52:58
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:02
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/1 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:02
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/1 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:07
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/25 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:07
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/25 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:23
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:23
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:32
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then @BeginTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then @EndTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:32
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then @BeginTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then @EndTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:59
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then @BeginTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then @EndTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:53:59
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then @BeginTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then @EndTime 
  else d_ListPutOnOff_OffTheShelfTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:51
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:51
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:53
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:54:53
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
      and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_LaunchTime] is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:40
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:40
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:48
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:55:48
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
      and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_LaunchTime] is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:56:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:56:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:56:25
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:56:25
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:37
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"2020/12/14 15:55:00"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:37
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"2020/12/14 15:55:00"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:39
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 15:59:39
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
      and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_LaunchTime] is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:"2020-12-14 15:55"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:00:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:00:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:00:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:00:55
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:00:55
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:01:01
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:01:02
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
    and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
      and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_LaunchTime] is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:02
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:03
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:47
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:03:47
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:04:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:04:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:04:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:00
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:00
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:01
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:01
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:03
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:03
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:08
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:08
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:22
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:22
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:47
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:47
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:48
类型：Query 查询对象：SelPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15
union all
select 14,'器具',15 
union all
select 15,'上架时间',25
union all
select 16,'上架数量',15
union all
select 17,'上架良品数',15
union all
select 18,'上架不良品数',15
union all
select 19,'上架返工数',15
union all
select 20,'上架操作人',15
union all
select 21,'上架操作人所属班次',20
union all
select 22,'上架原因',20
union all
select 23,'上架次数序数',15 
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:05:49
类型：Query 查询对象：SelPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数'
      ,tUser.s_UserName as '上架操作人'
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where  d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
   
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:06:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:40
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:40
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:40
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:41
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:07:52
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:08:12
类型：Query 查询对象：SelPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15
union all
select 14,'器具',15 
union all
select 15,'上架时间',25
union all
select 16,'上架数量',15
union all
select 17,'上架良品数',15
union all
select 18,'上架不良品数',15
union all
select 19,'上架返工数',15
union all
select 20,'上架操作人',15
union all
select 21,'上架操作人所属班次',20
union all
select 22,'上架原因',20
union all
select 23,'上架次数序数',15 
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:09:02
类型：Query 查询对象：SelPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数'
      ,tUser.s_UserName as '上架操作人'
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where  d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
   
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:24
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:24
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:50
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:50
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:50
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:52
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:52
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:10:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:22
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:22
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:31
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:31
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:32
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:32
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:33
类型：Query 查询对象：SelPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15 
union all
select 14,'器具',15 
union all
select 15,'下架时间',25
union all
select 16,'下架数量',15
union all
select 17,'下架良品数',15
union all
select 18,'下架不良品数',15
union all
select 19,'下架返工数',15
union all
select 20,'下架操作人',15
union all
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:11:34
类型：Query 查询对象：SelPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数'
      ,tUser.s_UserName as '下架操作人'
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'') = '' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（7）ParameterName:"@_txt_val" DbType:"String" Value:","
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:45
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:45
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:45
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:46
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:51
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:27:51
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:38
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:38
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:38
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:39
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:44
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:44
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:28:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:03
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:03
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:08
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:29:08
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:34:12
类型：Business 业务对象：Tool_AddModule 
说明：执行业务检查：1.*.模块ID已经存在
***************************************************************************************************************
SQL:
if not exists(
   select 1 from tModule where s_ModuleID=@:moduleID
)
select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:34:12
类型：Business 业务对象：Tool_AddModule 
说明：执行业务过程[1]：0.添加模块
***************************************************************************************************************
SQL:
INSERT INTO tModule
           (s_ModuleID
           ,s_ModuleName
           ,n_Tag
           ,s_ParentID
           ,s_Url
           ,s_IconUrl
           ,n_IsLeaf
           ,s_Helper
           ,n_No,
           b_IsCom,
    s_ComQueryName,
    s_ComObjectName,
    s_ComAddBiz,
    s_ComModifyBiz,
    s_ComDelBiz
)
     VALUES
           (
           @moduleID
           ,@moduleName
           ,isnull(@moduleStatus,0)
           ,@ParentID
           ,@moduleUrl
,@moduleIconUrl
           ,isnull(@moduleIsLeaf,0)
           ,@moduleHelper
           ,@moduleNo
 ,isnull(@moduleIsCom,0),
    @ComQueryName,
    @ComObjectName,
    @ComAddBiz,
    @ComModifyBiz,
    @ComDelBiz
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:00
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:00
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:00
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:07
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:18
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:35:18
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:40:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:40:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:40:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:57:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:57:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:57:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:57:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 16:57:17
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:34
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:34
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:34
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:34
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:34
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:46
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:46
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:46
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:46
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:46
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wmshwsjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:47
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:58
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:58
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:58
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:58
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:01:58
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:41
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:41
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:41
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:42
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:56
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:56
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:57
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:59
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:59
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:59
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:59
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:02:59
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:00
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:00
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:00
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:04
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:09
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelColumns"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:03:10
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：3.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelData"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:06:48
类型：Business 业务对象：Tool_AddModule 
说明：执行业务检查：1.*.模块ID已经存在
***************************************************************************************************************
SQL:
if not exists(
   select 1 from tModule where s_ModuleID=@:moduleID
)
select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czyxjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员下架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOffRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:06:48
类型：Business 业务对象：Tool_AddModule 
说明：执行业务过程[1]：0.添加模块
***************************************************************************************************************
SQL:
INSERT INTO tModule
           (s_ModuleID
           ,s_ModuleName
           ,n_Tag
           ,s_ParentID
           ,s_Url
           ,s_IconUrl
           ,n_IsLeaf
           ,s_Helper
           ,n_No,
           b_IsCom,
    s_ComQueryName,
    s_ComObjectName,
    s_ComAddBiz,
    s_ComModifyBiz,
    s_ComDelBiz
)
     VALUES
           (
           @moduleID
           ,@moduleName
           ,isnull(@moduleStatus,0)
           ,@ParentID
           ,@moduleUrl
,@moduleIconUrl
           ,isnull(@moduleIsLeaf,0)
           ,@moduleHelper
           ,@moduleNo
 ,isnull(@moduleIsCom,0),
    @ComQueryName,
    @ComObjectName,
    @ComAddBiz,
    @ComModifyBiz,
    @ComDelBiz
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czyxjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员下架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOffRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:06
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:06
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:06
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:07:50
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:08:01
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:08:01
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:14:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:14:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:14:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:22:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:22:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:22:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:22:12
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:25:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:25:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:25:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:25:28
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:25:28
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员下架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:27:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:27:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:04
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:04
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:04
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:05
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:07
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:08
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:28:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:27
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:31:33
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:28
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:28
类型：Query 查询对象：SelPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:34
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:45
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOffRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList_ExcelColumns"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:50
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：3.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOffRecordList_ExcelData"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:33:52
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:02
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:04
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:18
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:18
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:19
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:33
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:35
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:37
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:40
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:42
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:44
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:48
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:49
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:49
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:50
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:50
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:50
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:50
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:50
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:51
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:51
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:51
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:51
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:52
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:34:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:17
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:25
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:45
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:46
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:49
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:49
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:35:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:36:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:36:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:36:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:36:22
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:36:22
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:43
类型：Business 业务对象：Tool_EditModule 
说明：执行业务检查：1.*.找不到该父模块，或者该父模块为叶子
***************************************************************************************************************
SQL:
select 1 from tModule where s_ModuleID=@:ParentID and n_IsLeaf=0
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"AnsiString" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:"0"
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:44
类型：Business 业务对象：Tool_EditModule 
说明：执行业务检查：2.*.找不到该业务对象
***************************************************************************************************************
SQL:
select 1 from tModule where s_ModuleID=@:moduleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"AnsiString" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:"0"
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:44
类型：Business 业务对象：Tool_EditModule 
说明：执行业务检查：3.*.模块已经与业务对象或查询对象关联，不能设置为非叶子
***************************************************************************************************************
SQL:
if @:moduleIsLeaf<>1
begin
	if not exists(
		select * from tModuleBiz where s_ModuleID=@:moduleID
	) 
                      select 1
end
else
     select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"AnsiString" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:"0"
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:44
类型：Business 业务对象：Tool_EditModule 
说明：执行业务检查：4.*.模块含有子模块，不能设为叶子
***************************************************************************************************************
SQL:
if @:moduleIsLeaf=1
begin
	if not exists(
		select * from tModule where s_ParentID=@:moduleID
	) select 1
end
else
     select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"AnsiString" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:"0"
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:44
类型：Business 业务对象：Tool_EditModule 
说明：执行业务过程[1]：0.更新对象
***************************************************************************************************************
SQL:
UPDATE tModule
   SET s_ParentID=@ParentID
       ,s_ModuleName = @moduleName
      ,n_Tag = isnull(@moduleStatus,0)
      ,s_Url = @moduleUrl
       ,s_IconUrl=@moduleIconUrl
      ,n_IsLeaf = isnull(@moduleIsLeaf,0)
      ,s_Helper = @moduleHelper
      ,n_No = @moduleNo,
     b_IsCom= isnull(@moduleIsCom,0),
    s_ComQueryName=@ComQueryName,
    s_ComObjectName=@ComObjectName,
    s_ComAddBiz=@ComAddBiz,
    s_ComModifyBiz=@ComModifyBiz,
    s_ComDelBiz=@ComDelBiz
 WHERE s_ModuleID=@moduleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czysjjltj"
（10）ParameterName:"@moduleIsCom" DbType:"AnsiString" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员上架记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:"0"
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorPutOnRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:53
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:54
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:38:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:07
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:07
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:08
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:26
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:28
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:29
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:32
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecordOperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:36
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:37
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:39:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:13
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:13
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:19
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:27
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOperatorPutOnRecordList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询操作员上架记录信息(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:30
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:31
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:40:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:07
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:07
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:17
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:41:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:16
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czysjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:18
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:18
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:19
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:19
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:19
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"OperatorPutOnRecord"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:42:32
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czyxjjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:26
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:27
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:56
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       
      [s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
	  ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou] 
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:56
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:57
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:43:57
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:44:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:44:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:44:50
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:44:50
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:44:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:02
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       
      [s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
	  ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou] 
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:02
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:19
类型：Query 查询对象：SelOperatorPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select 1,'上架操作人',15
union all
select 2,'货物标识编码',15
union all
select 3,'储位二维码',15
union all
select 4,'货物产品名称',25
union all
select 5,'货物产品编码',15
union all
select 6,'U9工件编码',15
union all
select 7,'U9工件名称',25
union all
select 8,'APQP阶段',15
union all
select 9,'质量状态',15
union all
select 10,'规格型号',15
union all
select 11,'单位',15
union all
select 12,'车型',15
union all
select 13,'颜色',15
union all
select 14,'批次号',15
union all
select 15,'器具',15 
union all
select 16,'上架时间',25
union all
select 17,'上架数量',15
union all
select 18,'上架良品数',15
union all
select 19,'上架不良品数',15
union all
select 20,'上架返工数',15
union all 
select 21,'上架操作人所属班次',20
union all
select 22,'上架原因',20
union all
select 23,'上架次数序数',15 
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:19
类型：Query 查询对象：SelOperatorPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT 
      tUser.s_UserName as '上架操作人'
	  ,[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数' 
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where  d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'') = '' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
   
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-12-14 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（6）ParameterName:"@s_UserName" DbType:"String" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（8）ParameterName:"@_txt_val" DbType:"String" Value:","
（9）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（10）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:32
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       [s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou]
      ,[s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:32
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:33
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       
      [s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
	  ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou] 
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:33
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:34
类型：Query 查询对象：SelOperatorPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select 1,'下架操作人',15
union all
select 2,'货物标识编码',15
union all
select 3,'储位二维码',15
union all
select 4,'货物产品名称',25
union all
select 5,'货物产品编码',15
union all
select 6,'U9工件编码',15
union all
select 7,'U9工件名称',25
union all
select 8,'APQP阶段',15
union all
select 9,'质量状态',15
union all
select 10,'规格型号',15
union all
select 11,'单位',15
union all
select 12,'车型',15
union all
select 13,'颜色',15
union all
select 14,'批次号',15 
union all
select 15,'器具',15 
union all
select 16,'下架时间',25
union all
select 17,'下架数量',15
union all
select 18,'下架良品数',15
union all
select 19,'下架不良品数',15
union all
select 20,'下架返工数',15
union all 
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:34
类型：Query 查询对象：SelOperatorPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT 
      tUser.s_UserName as '下架操作人'
	  ,[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数' 
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'') = '' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
    and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@s_UserName" DbType:"String" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（8）ParameterName:"@_txt_val" DbType:"String" Value:","
（9）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（10）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:35
类型：Query 查询对象：SelOperatorPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select 1,'上架操作人',15
union all
select 2,'货物标识编码',15
union all
select 3,'储位二维码',15
union all
select 4,'货物产品名称',25
union all
select 5,'货物产品编码',15
union all
select 6,'U9工件编码',15
union all
select 7,'U9工件名称',25
union all
select 8,'APQP阶段',15
union all
select 9,'质量状态',15
union all
select 10,'规格型号',15
union all
select 11,'单位',15
union all
select 12,'车型',15
union all
select 13,'颜色',15
union all
select 14,'批次号',15
union all
select 15,'器具',15 
union all
select 16,'上架时间',25
union all
select 17,'上架数量',15
union all
select 18,'上架良品数',15
union all
select 19,'上架不良品数',15
union all
select 20,'上架返工数',15
union all 
select 21,'上架操作人所属班次',20
union all
select 22,'上架原因',20
union all
select 23,'上架次数序数',15 
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:45:35
类型：Query 查询对象：SelOperatorPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT 
      tUser.s_UserName as '上架操作人'
	  ,[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数' 
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where  d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'') = '' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
   
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（6）ParameterName:"@s_UserName" DbType:"String" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（8）ParameterName:"@_txt_val" DbType:"String" Value:","
（9）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（10）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:46
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
      [s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] 
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:46
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:51
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
      [s_ListPutOnOff_OffTheShelfOperator]= tUser.s_UserName
      ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber] 
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name
      ,[d_ListPutOnOff_OffTheShelfTime] = Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120)
      ,[n_ListPutOnOff_OffTheShelfNumber]
      ,[n_ListPutOnOff_OffTheShelfOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou]
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] 
      ,[s_ListPutOnOff_OffTheShelfClasses] 
      ,[s_ListPutOnOffReason_Reason]
      ,[n_ListPutOnOff_OffTheShelfType]
      ,[n_ListPutOnOff_OffTheShelfSequence] 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:46:52
类型：Query 查询对象：SelOperatorPutOffRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/27 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:47:56
类型：Query 查询对象：SelOperatorPutOffRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select 1,'下架操作人',15
union all
select 2,'货物标识编码',15
union all
select 3,'储位二维码',15
union all
select 4,'货物产品名称',25
union all
select 5,'货物产品编码',15
union all
select 6,'U9工件编码',15
union all
select 7,'U9工件名称',25
union all
select 8,'APQP阶段',15
union all
select 9,'质量状态',15
union all
select 10,'规格型号',15
union all
select 11,'单位',15
union all
select 12,'车型',15
union all
select 13,'颜色',15
union all
select 14,'批次号',15 
union all
select 15,'器具',15 
union all
select 16,'下架时间',25
union all
select 17,'下架数量',15
union all
select 18,'下架良品数',15
union all
select 19,'下架不良品数',15
union all
select 20,'下架返工数',15
union all 
select 21,'下架操作人所属班次',20
union all
select 22,'下架原因',20
union all
select 23,'下架次数序数',15
union all
select 24,'是否已提交',15
union all
select 25,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 17:47:56
类型：Query 查询对象：SelOperatorPutOffRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT 
      tUser.s_UserName as '下架操作人'
	  ,[s_ListPutOnOff_Code] as '储位二维码'  
      ,[s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号' 
	  ,tBin.s_Bin_Name as '器具'
      ,Convert(varchar(20),[d_ListPutOnOff_OffTheShelfTime],120) as '下架时间'
      ,[n_ListPutOnOff_OffTheShelfNumber] as '下架数量'
      ,[n_ListPutOnOff_OffTheShelfOKProductCou] as '下架良品数'
      ,[n_ListPutOnOff_OffTheShelfUnOKProductCou] as '下架不良品数'
      ,[n_ListPutOnOff_OffTheShelfReworkProductCou] as '下架返工数' 
      ,[s_ListPutOnOff_OffTheShelfClasses] as '下架操作人所属班次'
      ,[s_ListPutOnOffReason_Reason] as '下架原因'
      ,[n_ListPutOnOff_OffTheShelfSequence] as '下架次数序数'
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_OffTheShelfOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_OffTheShelfTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_OffTheShelfTime
  else @BeginTime  end)
  and d_ListPutOnOff_OffTheShelfTime <= (case when isnull(@EndTime,'') = '' then d_ListPutOnOff_OffTheShelfTime
  else @EndTime end)
  and  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
    and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
    and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_LaunchTime is null
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"String" Value:"2020-11-27 08:00"
（1）ParameterName:"@EndTime" DbType:"String" Value:""
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（4）ParameterName:"@s_ListPutOnOff_Code" DbType:"String" Value:""
（5）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（6）ParameterName:"@s_UserName" DbType:"String" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（8）ParameterName:"@_txt_val" DbType:"String" Value:","
（9）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（10）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:14:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:14:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:14:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:14:19
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
       
      [s_ListPutOnOff_LaunchOperator] = tUser.s_UserName
	  ,[s_ListPutOnOff_Code]
      ,[s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId] 
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
	  ,s_ListPutOnOff_BinName = tBin.s_Bin_Name 
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou] 
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:14:19
类型：Query 查询对象：SelOperatorPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tListPutOnOff.s_ListPutOnOff_LaunchOperator
  left join tBin tBin with(nolock) on tBin.n_Bin_Id = tListPutOnOff.n_Bin_Id
  where d_ListPutOnOff_LaunchTime >= (case when isnull(@BeginTime,'1900-01-01') = '1900-01-01' then d_ListPutOnOff_LaunchTime
  else @BeginTime end)
  and d_ListPutOnOff_LaunchTime <= (case when isnull(@EndTime,'2900-01-01') = '2900-01-01' then d_ListPutOnOff_LaunchTime
  else @EndTime end)
  and isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end) 
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and s_ListPutOnOff_Code like (case when ISNULL(@s_ListPutOnOff_Code,'') = ''
  then s_ListPutOnOff_Code else '%'+@s_ListPutOnOff_Code+'%' end)
  and tUser.s_UserName like (case when ISNULL(@s_UserName,'') = ''
  then tUser.s_UserName else '%'+@s_UserName+'%' end)

  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/12/14 8:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_ListPutOnOff_Code" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_UserName" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（8）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（9）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（10）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（11）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（12）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:18:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:21:47
类型：Business 业务对象：Tool_AddModule 
说明：执行业务检查：1.*.模块ID已经存在
***************************************************************************************************************
SQL:
if not exists(
   select 1 from tModule where s_ModuleID=@:moduleID
)
select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czypyjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员盘盈记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorInventorySurplusRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:21:47
类型：Business 业务对象：Tool_AddModule 
说明：执行业务过程[1]：0.添加模块
***************************************************************************************************************
SQL:
INSERT INTO tModule
           (s_ModuleID
           ,s_ModuleName
           ,n_Tag
           ,s_ParentID
           ,s_Url
           ,s_IconUrl
           ,n_IsLeaf
           ,s_Helper
           ,n_No,
           b_IsCom,
    s_ComQueryName,
    s_ComObjectName,
    s_ComAddBiz,
    s_ComModifyBiz,
    s_ComDelBiz
)
     VALUES
           (
           @moduleID
           ,@moduleName
           ,isnull(@moduleStatus,0)
           ,@ParentID
           ,@moduleUrl
,@moduleIconUrl
           ,isnull(@moduleIsLeaf,0)
           ,@moduleHelper
           ,@moduleNo
 ,isnull(@moduleIsCom,0),
    @ComQueryName,
    @ComObjectName,
    @ComAddBiz,
    @ComModifyBiz,
    @ComDelBiz
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czypyjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员盘盈记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorInventorySurplusRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:07
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:07
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:07
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:16
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypyjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:22
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypyjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorInventorySurplusRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:22:22
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypyjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorInventorySurplusRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:23:46
类型：Business 业务对象：Tool_AddModule 
说明：执行业务检查：1.*.模块ID已经存在
***************************************************************************************************************
SQL:
if not exists(
   select 1 from tModule where s_ModuleID=@:moduleID
)
select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czypkjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员盘亏记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorInventoryLossRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:23:46
类型：Business 业务对象：Tool_AddModule 
说明：执行业务过程[1]：0.添加模块
***************************************************************************************************************
SQL:
INSERT INTO tModule
           (s_ModuleID
           ,s_ModuleName
           ,n_Tag
           ,s_ParentID
           ,s_Url
           ,s_IconUrl
           ,n_IsLeaf
           ,s_Helper
           ,n_No,
           b_IsCom,
    s_ComQueryName,
    s_ComObjectName,
    s_ComAddBiz,
    s_ComModifyBiz,
    s_ComDelBiz
)
     VALUES
           (
           @moduleID
           ,@moduleName
           ,isnull(@moduleStatus,0)
           ,@ParentID
           ,@moduleUrl
,@moduleIconUrl
           ,isnull(@moduleIsLeaf,0)
           ,@moduleHelper
           ,@moduleNo
 ,isnull(@moduleIsCom,0),
    @ComQueryName,
    @ComObjectName,
    @ComAddBiz,
    @ComModifyBiz,
    @ComDelBiz
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"czypkjltj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"操作员盘亏记录统计"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/OperatorInventoryLossRecord/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:08
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypkjltj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:14
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypkjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorInventoryLossRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:14
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"czypkjltj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OperatorInventoryLossRecord"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:19
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:30
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:30
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:30
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:31
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:24:33
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:25
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:27
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/14 18:25:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^