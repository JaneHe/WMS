
**************************************************************************************************************------>2020/11/25 9:19:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:19:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:20:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:20:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:20:56
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"B26BE14EA7A932DE"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:20:56
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"B26BE14EA7A932DE"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:20:56
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"B26BE14EA7A932DE"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:02
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:02
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:03
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:03
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:03
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:04
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:05
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:06
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:08
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:09
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:21:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:46
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:23:58
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:02
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:16
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:28
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:40
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:24:43
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:42:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:42:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:42:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:49:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 9:49:10
类型：Query 查询对象：Tool_GetAllTable 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select TableName=name from sysobjects where xtype='U' order by name
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:24:03
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:24:03
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:24:03
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:24:04
类型：Query 查询对象：Tool_GetAllTable 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select TableName=name from sysobjects where xtype='U' order by name
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:06
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:06
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:55:12
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:56:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:56:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:56:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:56:03
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:24
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:24
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:26
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 10:57:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:27
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:28
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:29
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:30
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:41
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelPutOnOffSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPutOnOffSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPutOnOffSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增货物入库记录以及上架记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"UpdatePutOnOffSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交已选择的单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建上架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleReportInventoryCurrent"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据货物编码匹配出对应的库存信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:50
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleSubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的上架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:50
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：10.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询新建单据的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:50
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：11.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除上架单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:55
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:02:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:14
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:03:17
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:58
类型：Business 业务对象：DelBillStockInOutDetail 
说明：执行业务过程[1]：0.删除上架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"2FC9B6A5-FFE3-4517-84EC-39E0BE7C1003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"3EEE740F-4D08-4FCB-B6A5-81FFA1352676"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:05:59
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:04
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:06
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:06:09
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:05
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelPutOnOffSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPutOnOffSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPutOnOffSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增货物入库记录以及上架记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"UpdatePutOnOffSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交已选择的单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建上架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询上架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleReportInventoryCurrent"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据货物编码匹配出对应的库存信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleSubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的上架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：10.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPutOnOffSingleWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询新建单据的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:13:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：11.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelPutOnOffBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除上架单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:06
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OnShelfSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"OnShelfSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除下架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertOnShelfSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertOnShelfSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增货物出库记录以及下架记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"UpdateOnShelfSingleListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交已选择的单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:16
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建下架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询塑件与漆件BOM信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfSingleBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询下架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfSingleGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfSingleReportInventoryCurrent"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据货物编码匹配出对应的库存信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：10.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfSingleSubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的下架单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：11.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelOnShelfSingleWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询出库单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：12.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除下架单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:21
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:24
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:25
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:25
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:49
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:52
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:52
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:52
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:52
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:52
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:20:55
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:05
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:07
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:10
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:12
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:15
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:17
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:22:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:07
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:43
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:46
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:23:52
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:29:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:29:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:29:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 11:29:01
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:25
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:25
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:07:27
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:41
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:08:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:06
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:10
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:23
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:14:30
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:23:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:23:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:23:28
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:13
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:27:22
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:41:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:41:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:41:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:41:01
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:09
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:42:11
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:38
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:54
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"30"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"3E16EF15-87E2-4B54-84E0-C039B3989CBB"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:55
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"60"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D93243F0-CD2A-41FB-ACD4-BFEDC97FCA46"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:55
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"20"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"80"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"FAF2CA84-0704-46EF-852F-AE01D89A1711"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:56
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"30"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"3E16EF15-87E2-4B54-84E0-C039B3989CBB"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:43:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:04
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:25
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:31
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:33
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:38
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:47
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:53
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 13:44:58
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:03:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:03:14
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:03
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:04:05
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:56
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:58
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:06:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:00
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:04
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:07:06
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:29
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:35
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201125140929126"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:38
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:09:58
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:05
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:10:59
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:11:00
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:11:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:55
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:18:59
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:04
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:39
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:40
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:19:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:42
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:20:53
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:21:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:21:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:21:04
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:21:05
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"30"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:21:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:43
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:23:51
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:24:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:24:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:24:06
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:24:06
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"60"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:24:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:10
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:12
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:25:56
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:00
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:00
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:01
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:01
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:01
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelOnShelfBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:01
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelPutOnOffBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:42
类型：Business 业务对象：DelPutOnOffBillStockInOutDetail 
说明：执行业务过程[1]：0.删除上架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"9E1051E8-E3A5-46EB-9C57-FC86BC13D656"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"FB4B4B9D-A7CB-4EB0-A5E7-A810CEB743D0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:42
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:47
类型：Business 业务对象：DelPutOnOffBillStockInOutDetail 
说明：执行业务过程[1]：0.删除上架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"3D5A92EA-BAAC-4C72-B9CA-59CBBE65495B"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"DF5C48AB-EE9C-442C-A789-755E5782AF9B"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:26:48
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:32
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:33
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:37
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
and Tab2.s_ListPutOnOff_Batch = Tab.s_ListPutOnOff_Batch
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6EC46F91-410D-484E-B9CE-3835E934680F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:27:40
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:09
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:12
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:15
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:38
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:39
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:45
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:28:49
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:05
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:13
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201125142904861"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:15
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:29:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:30:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:30:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:30:05
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:13
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:33
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"20"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"60590DB1-E5A8-4ECC-B4CA-AC6555DC3158"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:33
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"90"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"10"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"82A3725A-6E02-4DD3-9028-FBFA6C22174F"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:34
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"20"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"60590DB1-E5A8-4ECC-B4CA-AC6555DC3158"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:31:40
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:25
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:44
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"30"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"0C13C2FD-6E82-422E-B86D-EBE76598FC93"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:44
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"80"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"20"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"45CA87E1-7849-41CC-8F7F-F04D9ADA28C7"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:44
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"30"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"0C13C2FD-6E82-422E-B86D-EBE76598FC93"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:48
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:32:50
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:32
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:35:51
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:36:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:36:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:36:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:36:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:36:52
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:24
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:37:35
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:38:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:38:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:38:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:38:33
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:17
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:22
类型：Business 业务对象：DelOnShelfBillStockInOutDetail 
说明：执行业务过程[1]：0.删除下架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"6D1BE96D-90A0-4816-8606-2CA6E3849A2D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"3BE9F9EC-5E53-490B-A185-8345E63691DF"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:23
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:26
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:28
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:30
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:39:40
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:42:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:42:52
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:42:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:42:59
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:43:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 14:43:01
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:45
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:45
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:45
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:12:48
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:16
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:16
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:16
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:17
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:18
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:13:22
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:04
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:09
类型：Business 业务对象：DelOnShelfBillStockInOutDetail 
说明：执行业务过程[1]：0.删除下架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"CFA6C017-EF85-4A0D-BBFD-7F602C8BBBF8"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"1B864A52-1441-408C-9A22-7F5F4DED6D6C"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:10
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AE079B54-2049-4600-AE99-EDC99E8E07FE"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:13
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:36
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:37
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:40
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:43
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:14:58
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:15:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:15:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:15:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:15:13
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:16:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:16:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:16:59
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201125151512699"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:02
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:12
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:17:18
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:54
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7FFD80A9-717D-4AFB-BF5C-CA57F358F31C"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7FFD80A9-717D-4AFB-BF5C-CA57F358F31C"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7FFD80A9-717D-4AFB-BF5C-CA57F358F31C"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"40"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:19:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:05
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:11
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:21
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7FFD80A9-717D-4AFB-BF5C-CA57F358F31C"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:22
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7FFD80A9-717D-4AFB-BF5C-CA57F358F31C"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"80"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:27
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:20:33
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:36:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:36:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:36:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:36:42
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  


--未提交上架单据的已占据库位的信息记录
declare @UnSubmitTable table(
    s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_LaunchNumber int
)

insert into @UnSubmitTable(
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_LaunchNumber
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
Sum(isnull(n_ListPutOnOff_LaunchNumber,0))
from tListPutOnOff tListPutOnOff with(nolock)
where isnull(s_ListPutOnOff_WhetherToSubmit,'0') = 0 
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 

update @table
set s_ReportInventoryCurrent_SurplusNumber = s_ReportInventoryCurrent_SurplusNumber - s_ReportInventoryCurrent_LaunchNumber
from @table tab 
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code = tab.s_ReportInventoryCurrent_Code 


select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:09
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:11
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:12
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:16
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:21
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201125153715532"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:24
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:30
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:43
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  


--未提交上架单据的已占据库位的信息记录
declare @UnSubmitTable table(
    s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_LaunchNumber int
)

insert into @UnSubmitTable(
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_LaunchNumber
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
Sum(isnull(n_ListPutOnOff_LaunchNumber,0))
from tListPutOnOff tListPutOnOff with(nolock)
where isnull(s_ListPutOnOff_WhetherToSubmit,'0') = 0 
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 

update @table
set s_ReportInventoryCurrent_SurplusNumber = s_ReportInventoryCurrent_SurplusNumber - s_ReportInventoryCurrent_LaunchNumber
from @table tab 
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code = tab.s_ReportInventoryCurrent_Code 


select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:54
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:37:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:00
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:08
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  


--未提交上架单据的已占据库位的信息记录
declare @UnSubmitTable table(
    s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_LaunchNumber int
)

insert into @UnSubmitTable(
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_LaunchNumber
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
Sum(isnull(n_ListPutOnOff_LaunchNumber,0))
from tListPutOnOff tListPutOnOff with(nolock)
where isnull(s_ListPutOnOff_WhetherToSubmit,'0') = 0 
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 

update @table
set s_ReportInventoryCurrent_SurplusNumber = s_ReportInventoryCurrent_SurplusNumber - s_ReportInventoryCurrent_LaunchNumber
from @table tab 
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code = tab.s_ReportInventoryCurrent_Code 


select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:27
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"80"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:27
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010105"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:27
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:31
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:38:37
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  


--未提交上架单据的已占据库位的信息记录
declare @UnSubmitTable table(
    s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_LaunchNumber int
)

insert into @UnSubmitTable(
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_LaunchNumber
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
Sum(isnull(n_ListPutOnOff_LaunchNumber,0))
from tListPutOnOff tListPutOnOff with(nolock)
where isnull(s_ListPutOnOff_WhetherToSubmit,'0') = 0 
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 

update @table
set s_ReportInventoryCurrent_SurplusNumber = s_ReportInventoryCurrent_SurplusNumber - s_ReportInventoryCurrent_LaunchNumber
from @table tab 
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code = tab.s_ReportInventoryCurrent_Code 


select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:19
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"90"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:19
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:20
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"70"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:24
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:29
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:35
类型：Business 业务对象：DelPutOnOffBillStockInOutDetail 
说明：执行业务过程[1]：0.删除上架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"2A2BFF24-25E0-45E7-A361-82C13EA76D44"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"65349623-FA9A-4C02-A108-7990D64C48CD"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:35
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:38
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:41
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:45
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
and Tab2.s_ListPutOnOff_Batch = Tab.s_ListPutOnOff_Batch
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"83DA0AE8-5E14-4B5F-B5C6-63FEF333DB7A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:40:49
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:23
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:24
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:37
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:40
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:41:45
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:10
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:42:42
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:37
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201125154241635"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:43:40
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:01
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:02
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:09
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:17
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:30
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"70"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"A2AE4FEF-7BA1-4FEC-8B51-91C596D97E5D"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:31
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"10"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"80"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"E6BF72E6-EE5B-44F9-8131-917CE43F162D"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:31
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"70"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"A2AE4FEF-7BA1-4FEC-8B51-91C596D97E5D"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:36
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:40
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:54
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"20"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"10ADECA0-BFD2-42A6-B6B2-61963D0C77C3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:54
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"50"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"50"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"56C2A815-93A4-4980-BB23-B4CF50C401F7"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:55
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"20"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"10ADECA0-BFD2-42A6-B6B2-61963D0C77C3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:44:59
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'
and tBillStockInOut.s_BillStockInOut_Code like 'CK%'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:03
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的下架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_OffTheShelfNumber) as n_ListPutOnOff_OffTheShelfNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = 1
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
and d_ListPutOnOff_LaunchTime is null
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode

 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:14
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"10"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D4AA4237-29AF-471B-9842-C237787DDF7F"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:15
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"50"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"30"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"25E94A3C-C202-40D2-A696-9E4371840F55"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:15
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"10"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D4AA4237-29AF-471B-9842-C237787DDF7F"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:45:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:47
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:47:50
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:01
类型：Business 业务对象：DelOnShelfBillStockInOutDetail 
说明：执行业务过程[1]：0.删除下架单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tListStockInOut set   
    n_ListStockInOut_state=2, 
    s_ListStockInOut_Updator=@Operator,
    d_ListStockInOut_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	
update tListPutOnOff set  
    n_ListPutOnOff_state=2, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOff_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"FDEA3635-9ED5-4868-98F8-E003FAC7C48D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ListPutOnOff_Id" DbType:"String" Value:"005C1B20-0D60-4E24-A693-8756D5158677"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:01
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:05
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:10
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:14
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:19
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:20
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:25
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:27
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:37
类型：Business 业务对象：UpdateOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--下架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--下架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrentDetail_BatchNumber varchar(max), 
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)


insert into @TabDetail
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
	s_ReportInventoryCurrentDetail_BatchNumber,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
	s_ListPutOnOff_BatchNumber,
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus,s_ListPutOnOff_BatchNumber


insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) - Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 

 

--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) - Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
where n_ReportInventoryCurrentDetail_state = 1 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B68F1DCC-1D29-4BC9-A7B5-522D4F79A1AD"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:48:40
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:30
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:49:34
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:28
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:50:31
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:51:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:51:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:51:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:51:46
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:51:46
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:52:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:52:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:52:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:52:23
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:52:23
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:11
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Rack_Id asc),* from (
SELECT 
--[Columns]
      n_Rack_Id
      ,[s_Block_Name]
      ,[s_Warehouse_Name]
      ,[s_Rack_StorageType]
      ,s_Rack_CodePrefix
      ,[s_Rack_Code]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_LayerCapacity] 
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]=
      (case isnull([n_Rack_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length]
      ,(case isnull([n_Rack_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) as n_Rack_UsageStatus
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]=(case n_Rack_state when 1 then '正常' else '停用' end)
      ,[s_Rack_Creator]
      ,[d_Rack_CreateTime]
      ,[s_Rack_Updator]
      ,[d_Rack_UpdateTime]
--[/Columns]
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:53:11
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:53
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:54:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:55:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:55:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:55:00
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:57:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:57:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:57:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:57:53
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:51
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:58:56
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:25
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:28
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 15:59:56
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:54
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:54
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:54
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:55
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:00:57
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:18
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:21
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:51
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:01:55
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:13:34
类型：Business 业务对象：Tool_AddModule 
说明：执行业务检查：1.*.模块ID已经存在
***************************************************************************************************************
SQL:
if not exists(
   select 1 from tModule where s_ModuleID=@:moduleID
)
select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"wms-dbsj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:"null"
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"打包上架"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:"null"
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/PackingPutOnOffSingle/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:13:34
类型：Business 业务对象：Tool_AddModule 
说明：执行业务过程[1]：0.添加模块
***************************************************************************************************************
SQL:
INSERT INTO tModule
           (s_ModuleID
           ,s_ModuleName
           ,n_Tag
           ,s_ParentID
           ,s_Url
           ,s_IconUrl
           ,n_IsLeaf
           ,s_Helper
           ,n_No,
           b_IsCom,
    s_ComQueryName,
    s_ComObjectName,
    s_ComAddBiz,
    s_ComModifyBiz,
    s_ComDelBiz
)
     VALUES
           (
           @moduleID
           ,@moduleName
           ,isnull(@moduleStatus,0)
           ,@ParentID
           ,@moduleUrl
,@moduleIconUrl
           ,isnull(@moduleIsLeaf,0)
           ,@moduleHelper
           ,@moduleNo
 ,isnull(@moduleIsCom,0),
    @ComQueryName,
    @ComObjectName,
    @ComAddBiz,
    @ComModifyBiz,
    @ComDelBiz
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ComAddBiz" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ComDelBiz" DbType:"AnsiString" Value:""
（4）ParameterName:"@ComModifyBiz" DbType:"AnsiString" Value:""
（5）ParameterName:"@ComObjectName" DbType:"AnsiString" Value:""
（6）ParameterName:"@ComQueryName" DbType:"AnsiString" Value:""
（7）ParameterName:"@moduleHelper" DbType:"AnsiString" Value:""
（8）ParameterName:"@moduleIconUrl" DbType:"AnsiString" Value:""
（9）ParameterName:"@moduleID" DbType:"AnsiString" Value:"wms-dbsj"
（10）ParameterName:"@moduleIsCom" DbType:"Boolean" Value:""
（11）ParameterName:"@moduleIsLeaf" DbType:"Boolean" Value:"True"
（12）ParameterName:"@moduleName" DbType:"AnsiString" Value:"打包上架"
（13）ParameterName:"@moduleNo" DbType:"AnsiString" Value:""
（14）ParameterName:"@moduleStatus" DbType:"Int32" Value:""
（15）ParameterName:"@moduleUrl" DbType:"AnsiString" Value:"/PackingPutOnOffSingle/Index"
（16）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:39
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:39
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:14:41
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:04
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:05
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:05
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:08
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:23
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:29
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:29
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:44
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:47
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:51
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:20:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:00
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:03
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:21:08
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:09
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
 
 select * from ( select RowNumber=row_number() over(order by n_Bin_Id asc),* from (
SELECT 
--[Columns]
      [n_Bin_Id]
      ,[s_Bin_Name]
      ,[f_Bin_LocationCapacity]
      ,[f_Bin_ApplianceCapacity]
      ,[n_Bin_UsageStatus]=(case isnull([n_Bin_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) 
      ,[s_Bin_CustomFields1]
      ,[s_Bin_CustomFields2]
      ,[s_Bin_CustomFields3]
      ,[s_Bin_CustomFields4]
      ,[s_Bin_CustomFields5]
      ,[s_Bin_CustomFields6]
      ,[s_Bin_CustomFields7]
      ,[s_Bin_CustomFields8]
      ,[s_Bin_CustomFields9]
      ,[s_Bin_CustomFields10]
      ,[n_Bin_State]=(case n_Bin_State when 1 then '正常' else '停用' end)
      ,[s_Bin_Creator]
      ,[d_Bin_CreateTime]
      ,[s_Bin_Updator]
      ,[d_Bin_UpdateTime]
--[/Columns]
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:09
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
 
  select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
 ) T_RowsCount 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:24:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:26:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:26:48
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"qjjcxxgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:26:58
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:00
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListPutOnOff"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:04
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:15
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"器具编码"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Bin_Code"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tBin"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:"器具基础信息表"
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"器具基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:16
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:27:17
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:36
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
 
 select * from ( select RowNumber=row_number() over(order by n_Bin_Id asc),* from (
SELECT 
--[Columns]
      [n_Bin_Id]
      ,[s_Bin_Name]
      ,[s_Bin_Code]
      ,[f_Bin_LocationCapacity]
      ,[f_Bin_ApplianceCapacity]
      ,[n_Bin_UsageStatus]=(case isnull([n_Bin_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) 
      ,[s_Bin_CustomFields1]
      ,[s_Bin_CustomFields2]
      ,[s_Bin_CustomFields3]
      ,[s_Bin_CustomFields4]
      ,[s_Bin_CustomFields5]
      ,[s_Bin_CustomFields6]
      ,[s_Bin_CustomFields7]
      ,[s_Bin_CustomFields8]
      ,[s_Bin_CustomFields9]
      ,[s_Bin_CustomFields10]
      ,[n_Bin_State]=(case n_Bin_State when 1 then '正常' else '停用' end)
      ,[s_Bin_Creator]
      ,[d_Bin_CreateTime]
      ,[s_Bin_Updator]
      ,[d_Bin_UpdateTime]
--[/Columns]
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:36
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
 
  select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
 ) T_RowsCount 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:39
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:39
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:44
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:44
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:57
类型：Business 业务对象：Tool_UpdateDictionary 
说明：执行业务检查：1.0.该字段在相同的本地化、情景中已经存在
***************************************************************************************************************
SQL:
 if @:UpdateFlag='delete'
select 1
else

if exists (
select 1 from tDictionary 
where s_Field=@:Field 
and s_Location=@:Location 
and s_Scene=@:Scene
and n_ID!=@:ID
)
     select 1 where 1=2
else
     select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Caption" DbType:"String" Value:"器具编码"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@CommonID" DbType:"String" Value:""
（4）ParameterName:"@Field" DbType:"String" Value:"s_Bin_Code"
（5）ParameterName:"@Format" DbType:"String" Value:""
（6）ParameterName:"@ID" DbType:"AnsiString" Value:"null"
（7）ParameterName:"@Location" DbType:"String" Value:"chs"
（8）ParameterName:"@Scene" DbType:"String" Value:""
（9）ParameterName:"@Sql" DbType:"String" Value:""
（10）ParameterName:"@Type" DbType:"String" Value:""
（11）ParameterName:"@UpdateFlag" DbType:"String" Value:"add"
（12）ParameterName:"@Width" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:57
类型：Business 业务对象：Tool_UpdateDictionary 
说明：执行业务过程[1]：0.根据状态更新数据字典
***************************************************************************************************************
SQL:

if @UpdateFlag='add'

insert into tDictionary (
    s_Field,
    s_Scene,
    s_Location,
    s_Caption,
    s_Type,
    s_Format,
    s_CommonID,
    s_Sql,
    s_Width
)values (
    rtrim(@Field),
    rtrim(@Scene),
    @Location,
    @Caption,
    @Type,
    @Format,
    @CommonID,
    @Sql,
    @Width
)
else if @UpdateFlag='update'
update tDictionary set 
    s_Field=rtrim(@Field),
    s_Scene=rtrim(@Scene),
    s_Location=@Location,
    s_Caption=@Caption,
    s_Type=@Type,
    s_Format=@Format,
    s_CommonID=@CommonID,
    s_Sql=@Sql,
    s_Width=@Width
where     n_ID=@ID
else if @UpdateFlag='delete'
delete from tDictionary 
where     n_ID=@ID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Caption" DbType:"String" Value:"器具编码"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@CommonID" DbType:"String" Value:""
（4）ParameterName:"@Field" DbType:"String" Value:"s_Bin_Code"
（5）ParameterName:"@Format" DbType:"String" Value:""
（6）ParameterName:"@ID" DbType:"AnsiString" Value:""
（7）ParameterName:"@Location" DbType:"String" Value:"chs"
（8）ParameterName:"@Scene" DbType:"String" Value:""
（9）ParameterName:"@Sql" DbType:"String" Value:""
（10）ParameterName:"@Type" DbType:"String" Value:""
（11）ParameterName:"@UpdateFlag" DbType:"String" Value:"add"
（12）ParameterName:"@Width" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:58
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:33:58
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:07
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
 
 select * from ( select RowNumber=row_number() over(order by n_Bin_Id asc),* from (
SELECT 
--[Columns]
      [n_Bin_Id]
      ,[s_Bin_Name]
      ,[s_Bin_Code]
      ,[f_Bin_LocationCapacity]
      ,[f_Bin_ApplianceCapacity]
      ,[n_Bin_UsageStatus]=(case isnull([n_Bin_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) 
      ,[s_Bin_CustomFields1]
      ,[s_Bin_CustomFields2]
      ,[s_Bin_CustomFields3]
      ,[s_Bin_CustomFields4]
      ,[s_Bin_CustomFields5]
      ,[s_Bin_CustomFields6]
      ,[s_Bin_CustomFields7]
      ,[s_Bin_CustomFields8]
      ,[s_Bin_CustomFields9]
      ,[s_Bin_CustomFields10]
      ,[n_Bin_State]=(case n_Bin_State when 1 then '正常' else '停用' end)
      ,[s_Bin_Creator]
      ,[d_Bin_CreateTime]
      ,[s_Bin_Updator]
      ,[d_Bin_UpdateTime]
--[/Columns]
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:07
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
 
  select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
 ) T_RowsCount 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:34:32
类型：Query 查询对象：SelBin 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_Bin_Id]
      ,[s_Bin_Name]
      ,[s_Bin_Code]
      ,[f_Bin_LocationCapacity]
      ,[f_Bin_ApplianceCapacity]
      ,[n_Bin_UsageStatus]
      ,[s_Bin_CustomFields1]
      ,[s_Bin_CustomFields2]
      ,[s_Bin_CustomFields3]
      ,[s_Bin_CustomFields4]
      ,[s_Bin_CustomFields5]
      ,[s_Bin_CustomFields6]
      ,[s_Bin_CustomFields7]
      ,[s_Bin_CustomFields8]
      ,[s_Bin_CustomFields9]
      ,[s_Bin_CustomFields10]
      ,[n_Bin_State] 
  FROM [dbo].[tBin] with(nolock)
  where n_Bin_Id = @n_Bin_Id
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Bin_Id" DbType:"AnsiString" Value:"F634225C-4CB2-4EAD-B458-6E8993A0D5AB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:16
类型：Business 业务对象：UpdateBin 
说明：执行业务过程[1]：0.修改容器
***************************************************************************************************************
SQL:

update tBin set  
    s_Bin_Name=@s_Bin_Name,
    s_Bin_Code=@s_Bin_Code,
    f_Bin_LocationCapacity=@f_Bin_LocationCapacity,
    f_Bin_ApplianceCapacity=@f_Bin_ApplianceCapacity, 
    s_Bin_CustomFields1=@s_Bin_CustomFields1,
    s_Bin_CustomFields2=@s_Bin_CustomFields2,
    s_Bin_CustomFields3=@s_Bin_CustomFields3,
    s_Bin_CustomFields4=@s_Bin_CustomFields4,
    s_Bin_CustomFields5=@s_Bin_CustomFields5,
    s_Bin_CustomFields6=@s_Bin_CustomFields6,
    s_Bin_CustomFields7=@s_Bin_CustomFields7,
    s_Bin_CustomFields8=@s_Bin_CustomFields8,
    s_Bin_CustomFields9=@s_Bin_CustomFields9,
    s_Bin_CustomFields10=@s_Bin_CustomFields10, 
    s_Bin_Updator=@Operator,
    d_Bin_UpdateTime=getdate()
    where n_Bin_Id=@Sel_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_Bin_Name" DbType:"AnsiString" Value:"F45/F49扰流板上部内部存储器具"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@f_Bin_LocationCapacity" DbType:"AnsiString" Value:"0"
（4）ParameterName:"@f_Bin_ApplianceCapacity" DbType:"AnsiString" Value:"0"
（5）ParameterName:"@s_Bin_CustomFields1" DbType:"AnsiString" Value:""
（6）ParameterName:"@s_Bin_CustomFields2" DbType:"AnsiString" Value:""
（7）ParameterName:"@s_Bin_CustomFields3" DbType:"AnsiString" Value:""
（8）ParameterName:"@s_Bin_CustomFields4" DbType:"AnsiString" Value:""
（9）ParameterName:"@s_Bin_CustomFields5" DbType:"AnsiString" Value:""
（10）ParameterName:"@s_Bin_CustomFields6" DbType:"AnsiString" Value:""
（11）ParameterName:"@s_Bin_CustomFields7" DbType:"AnsiString" Value:""
（12）ParameterName:"@s_Bin_CustomFields8" DbType:"AnsiString" Value:""
（13）ParameterName:"@s_Bin_CustomFields9" DbType:"AnsiString" Value:""
（14）ParameterName:"@s_Bin_CustomFields10" DbType:"AnsiString" Value:""
（15）ParameterName:"@Sel_Id" DbType:"AnsiString" Value:"F634225C-4CB2-4EAD-B458-6E8993A0D5AB"
（16）ParameterName:"@s_Bin_Code" DbType:"AnsiString" Value:"F4XU0187"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:18
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
 
 select * from ( select RowNumber=row_number() over(order by n_Bin_Id asc),* from (
SELECT 
--[Columns]
      [n_Bin_Id]
      ,[s_Bin_Name]
      ,[s_Bin_Code]
      ,[f_Bin_LocationCapacity]
      ,[f_Bin_ApplianceCapacity]
      ,[n_Bin_UsageStatus]=(case isnull([n_Bin_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) 
      ,[s_Bin_CustomFields1]
      ,[s_Bin_CustomFields2]
      ,[s_Bin_CustomFields3]
      ,[s_Bin_CustomFields4]
      ,[s_Bin_CustomFields5]
      ,[s_Bin_CustomFields6]
      ,[s_Bin_CustomFields7]
      ,[s_Bin_CustomFields8]
      ,[s_Bin_CustomFields9]
      ,[s_Bin_CustomFields10]
      ,[n_Bin_State]=(case n_Bin_State when 1 then '正常' else '停用' end)
      ,[s_Bin_Creator]
      ,[d_Bin_CreateTime]
      ,[s_Bin_Updator]
      ,[d_Bin_UpdateTime]
--[/Columns]
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:35:18
类型：Query 查询对象：SelBinList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
 
  select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tBin] with(nolock)
where s_Bin_Name like (case when isnull(@Bin_Name,'') = '' then s_Bin_Name else '%'+@Bin_Name+'%' end) 
and n_Bin_State = (case when isnull(@Bin_State,0) = 0 then n_Bin_State else @Bin_State end)
 ) T_RowsCount 
 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Bin_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Bin_State" DbType:"Int32" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（5）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:02
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:36:16
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:37:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:37:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:37:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:37:47
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:38:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:38:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:38:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:38:15
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:39:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:39:45
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:12
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:19
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:19
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 16:41:19
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建进行打包上架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:48
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:48
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:48
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:49
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:01:50
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:03:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:03:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:03:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:03:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建进行打包上架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:03:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffSingleWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询打包入库单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:07:58
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:08:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:08:00
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:09:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:09:04
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"入库单类型（1: 普通入库，2:打包入库）"
（4）ParameterName:"@Column" DbType:"String" Value:"n_BillStockInOut_Type"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tBillStockInOut"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:"货物出入库单表"
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货物出入库单表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:09:05
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:09:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:09:06
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:25:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:25:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:25:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:25:30
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PackingPutOnOffSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffBillStockInOutSingle"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建进行打包上架单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffSingleWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询打包入库单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:17
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增打包上架单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:36
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:49
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-dbsj"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPackingPutOnOffSingleBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffBillStockInOutSingle"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 17:26:54
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelPackingPutOnOffSingleWarehouseInfo"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:25
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:26
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:28
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:35
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    1,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201125180027207"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:39
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
and n_BillStockInOut_Type = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:51
类型：Query 查询对象：SelPackingPutOnOffBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:54
类型：Query 查询对象：SelPackingPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:00:59
类型：Business 业务对象：InsertPackingPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增打包上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    2,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201125180053593"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:01:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:01:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:01:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/25 18:01:03
类型：Query 查询对象：SelPackingPutOnOffBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^